<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <title>Sign in ‚Äî OMNIXIUS</title>
  <link rel="stylesheet" href="../css/style.css">
  <link rel="stylesheet" href="css/app.css">
</head>
<body>
  <header class="header">
    <div class="container">
      <a href="../index.html" class="logo">OMNIXIUS</a>
      <nav class="nav nav-main nav-unified">
        <div class="nav-group nav-group-main">
          <span class="nav-group-label" data-i18n="navMain">Main</span>
          <a href="../index.html" data-i18n="home">Home</a>
          <a href="login.html" id="navLogin" class="nav-cta" data-i18n="signIn">Sign in</a>
          <a href="#" id="navLogout" style="display:none;" data-i18n="signOut">Sign out</a>
        </div>
        <div class="nav-group nav-group-app">
          <span class="nav-group-label" data-i18n="navApp">App</span>
          <a href="marketplace.html" data-i18n="navMarketplace">Marketplace</a>
          <a href="mail.html" data-i18n="navMail">Mail</a>
          <a href="orders.html" data-i18n="navOrders">Orders</a>
          <a href="dashboard.html" data-i18n="navProfile">Profile</a>
          <a href="ai.html">AI</a>
        </div>
        <div class="nav-group nav-group-more nav-drop">
          <span class="nav-group-label" data-i18n="navMore">More</span>
          <button type="button" class="nav-drop-trigger" aria-expanded="false" aria-haspopup="true"><span data-i18n="navMore">More</span> ‚ñæ</button>
          <div class="nav-drop-panel">
            <a href="trade.html" data-i18n="cardTrade">Trade & Finance</a>
            <a href="connect.html" data-i18n="cardConnect">Connect</a>
            <a href="repositorium.html" data-i18n="cardRepositorium">Repositorium</a>
            <a href="ixi.html" data-i18n="cardIxi">Blockchain IXI</a>
            <a href="vault.html">Vault</a>
            <a href="learning.html" data-i18n="cardLearning">Learning</a>
            <a href="startups.html" data-i18n="cardStartups">Startups</a>
            <a href="media.html" data-i18n="cardMedia">Media</a>
            <a href="rewards.html" data-i18n="cardRewards">Rewards</a>
          </div>
          <div class="nav-group-app-links">
            <a href="trade.html">Trade</a>
            <a href="connect.html">Connect</a>
            <a href="repositorium.html">Repositorium</a>
            <a href="ixi.html">IXI</a>
            <a href="vault.html">Vault</a>
            <a href="learning.html">Learning</a>
            <a href="startups.html">Startups</a>
            <a href="media.html">Media</a>
            <a href="rewards.html">Rewards</a>
          </div>
        </div>
        <div class="nav-group nav-group-info nav-drop">
          <span class="nav-group-label" data-i18n="navInfo">Info</span>
          <button type="button" class="nav-drop-trigger" aria-expanded="false" aria-haspopup="true"><span data-i18n="navInfo">Info</span> ‚ñæ</button>
          <div class="nav-drop-panel">
            <a href="../ecosystem.html" data-i18n="navEcosystem">Ecosystem</a>
            <a href="../architecture.html" data-i18n="navArchitecture">Architecture</a>
            <a href="../contact.html" data-i18n="navContact">Contact</a>
          </div>
          <div class="nav-group-app-links">
            <a href="../ecosystem.html">Ecosystem</a>
            <a href="../architecture.html">Architecture</a>
            <a href="../contact.html">Contact</a>
          </div>
        </div>
      </nav>
      <div class="lang-switcher">
        <span class="lang-switcher-label" data-i18n="langLabel">Language</span>
        <a href="#" data-lang="en">EN</a>
        <a href="#" data-lang="ru">RU</a>
        <a href="#" data-lang="fr">FR</a>
        <a href="#" data-lang="de">DE</a>
        <a href="#" data-lang="es">ES</a>
        <a href="#" data-lang="it">IT</a>
        <a href="#" data-lang="ar">AR</a>
        <a href="#" data-lang="zh">ZH</a>
        <a href="#" data-lang="ja">JA</a>
      </div>
      <button class="menu-toggle" aria-label="Menu"><span></span></button>
    </div>
  </header>
  <main class="app-page app-page-auth">
    <div class="container">
      <div id="apiUrlHint" class="api-url-hint" style="display:none;"></div>
      <div class="auth-card">
        <h1 class="auth-title" data-i18n="loginTitle">Sign in</h1>
        <form class="app-form app-form-slim" id="form" novalidate>
          <p class="error" id="err" style="display:none;" role="alert"></p>
          <label data-i18n="email">Email</label>
          <input type="email" name="email" required autocomplete="email" placeholder="you@example.com" id="loginEmail" autofocus>
          <label data-i18n="password">Password</label>
          <div class="input-with-toggle">
            <input type="password" name="password" required autocomplete="current-password" id="pwd">
            <button type="button" class="pwd-toggle" aria-label="Show password" id="pwdToggle">üëÅ</button>
          </div>
          <label class="checkbox-label">
            <input type="checkbox" name="remember" id="remember" checked>
            <span data-i18n="rememberMe">Keep me signed in</span>
          </label>
          <button type="submit" class="btn btn-primary btn-block" id="submitBtn" data-i18n="signIn">Sign in</button>
        </form>
        <p class="auth-links"><a href="forgot-password.html" data-i18n="forgotPassword">Forgot password?</a> ¬∑ <a href="register.html" data-i18n="noAccount">Register</a></p>
        <p class="auth-links" style="margin-top:0.5rem; font-size:0.9rem;"><a href="test-register.html?api_url=http://localhost:3000">Quick test</a> (run backend: <code>go run .</code> in backend-go)</p>
      </div>
    </div>
  </main>
  <script src="config.js"></script>
  <script src="js/i18n.js"></script>
  <script src="js/api.js"></script>
  <script>
    var needApiUrl = !window.API_URL && location.hostname !== 'localhost' && location.hostname !== '127.0.0.1';
    function askApiUrl() {
      var url = prompt((typeof window.i18n !== 'undefined' && window.i18n.t('apiUrlPrompt')) || 'Backend URL (to sign in):', localStorage.getItem('omnixius_api_url') || '');
      if (url && url.trim()) { var u = (typeof window.normalizeApiUrl === 'function' ? window.normalizeApiUrl(url) : url.trim().replace(/\/+$/, '')) || url.trim(); if (u) { localStorage.setItem('omnixius_api_url', u); location.reload(); } }
      return !!url;
    }
    (function () {
      var hint = document.getElementById('apiUrlHint');
      var t = function (k, d) { return (typeof window.i18n !== 'undefined' && window.i18n.t(k)) || d || k; };
      if (needApiUrl) {
        var ph = t('apiUrlPlaceholder', 'http://localhost:3000');
        var useT = t('saveApiUrl', 'Use');
        hint.innerHTML = '<p class="api-url-hint-title">Backend URL</p><p class="api-url-reality"><strong>Why it does not work:</strong> This site is only static (GitHub Pages). Registration and login need a running API server (backend-go). It is not deployed on the internet ‚Äî so you must run it on your computer and open this page from the same computer, or deploy the backend (e.g. Render) and use that URL.</p><p class="api-url-hint-explain">Run <code>go run .</code> in backend-go, then paste <code>http://localhost:3000</code> and click Use.</p><div class="api-url-row"><input type="url" id="apiUrlInput" placeholder="' + ph + '" value="" autocomplete="url"><button type="button" class="btn btn-primary" id="saveApiUrl">' + useT + '</button></div><p id="apiUrlCheckResult" class="api-url-check-result" style="display:none;"></p>';
        hint.style.display = 'block';
        hint.classList.add('api-url-hint-required');
        var input = document.getElementById('apiUrlInput');
        if (input) input.value = localStorage.getItem('omnixius_api_url') || '';
        document.getElementById('saveApiUrl').onclick = function (e) {
          e.preventDefault();
          var raw = (document.getElementById('apiUrlInput').value || '').trim();
          var url = (typeof window.normalizeApiUrl === 'function' ? window.normalizeApiUrl(raw) : raw.replace(/\/+$/, '')) || raw;
          var resEl = document.getElementById('apiUrlCheckResult');
          if (!url) { if (resEl) { resEl.textContent = 'Enter URL'; resEl.style.display = 'block'; resEl.style.color = '#e74c3c'; } return; }
          if (resEl) { resEl.textContent = '‚Ä¶'; resEl.style.display = 'block'; resEl.style.color = 'inherit'; }
          localStorage.setItem('omnixius_api_url', url);
          fetch(url.replace(/\/+$/, '') + '/health', { method: 'GET' }).then(function (r) { return r.ok ? r.json() : Promise.reject(); }).then(function () {
            location.reload();
          }).catch(function () {
            if (resEl) { resEl.textContent = (typeof window.i18n !== 'undefined' && window.i18n.t('backendNotReachable')) || 'Backend not running. Run: go run . in backend-go'; resEl.style.color = '#e74c3c'; }
          });
        };
      } else if (location.hostname !== 'localhost' && location.hostname !== '127.0.0.1' && window.API_URL) {
        hint.innerHTML = '<a href="#" id="changeApiUrl">' + ((typeof window.i18n !== 'undefined' && window.i18n.t('changeApiUrl')) || 'Change API URL') + '</a>';
        hint.style.display = 'block';
        hint.style.marginBottom = '0.5rem';
        document.getElementById('changeApiUrl').onclick = function (e) {
          e.preventDefault();
          var url = prompt('Backend API URL:', localStorage.getItem('omnixius_api_url') || window.API_URL || '');
          if (url !== null && url.trim()) { var u = (typeof window.normalizeApiUrl === 'function' ? window.normalizeApiUrl(url) : url.replace(/\/+$/, '')) || url.trim(); localStorage.setItem('omnixius_api_url', u); location.reload(); }
        };
      }
      if (typeof window.i18n !== 'undefined' && window.i18n.apply) i18n.apply();
    })();
    try { if (typeof api !== 'undefined' && api.getToken && api.getToken()) { location.href = 'dashboard.html'; } } catch (_) {}
    (function () {
      var pwd = document.getElementById('pwd');
      var btn = document.getElementById('pwdToggle');
      if (pwd && btn) btn.onclick = function () { var isPass = pwd.type === 'password'; pwd.type = isPass ? 'text' : 'password'; btn.setAttribute('aria-label', isPass ? 'Hide password' : 'Show password'); btn.textContent = isPass ? 'üôà' : 'üëÅ'; };
    })();
    var formEl = document.getElementById('form');
    if (formEl) formEl.onsubmit = async (e) => {
      e.preventDefault();
      var err = document.getElementById('err');
      var btn = document.getElementById('submitBtn');
      var form = e.target;
      var btnText = btn ? btn.textContent : '';
      if (err) err.style.display = 'none';
      if (typeof api === 'undefined' || !api.auth || !api.auth.login) {
        if (err) { err.textContent = 'Page error: scripts did not load. Open from the same site (e.g. index ‚Üí Sign in).'; err.style.display = 'block'; }
        return;
      }
      var email = (form.email && form.email.value || '').trim();
      var password = (form.password && form.password.value) || '';
      if (!email || !password) {
        if (err) { err.textContent = (typeof window.i18n !== 'undefined' && i18n.t('fillEmailPassword')) || 'Enter email and password'; err.style.display = 'block'; }
        return;
      }
      if (!window.API_URL && location.hostname !== 'localhost' && location.hostname !== '127.0.0.1') {
        if (err) { err.textContent = (typeof window.i18n !== 'undefined' && i18n.t('cannotConnect')) || 'Set backend URL first (click the link above or enter when prompted).'; err.style.display = 'block'; }
        askApiUrl();
        return;
      }
      var remember = !!(form.remember && form.remember.checked);
      if (btn) { btn.disabled = true; btn.textContent = (typeof window.i18n !== 'undefined' && i18n.t('signingIn')) || 'Signing in‚Ä¶'; }
      try {
        var data = await api.auth.login(email, password);
        if (!data || !data.token) { if (err) { err.textContent = (typeof window.i18n !== 'undefined' && i18n.t('signInFailed')) || 'Sign in failed'; err.style.display = 'block'; } if (btn) { btn.disabled = false; btn.textContent = btnText; } return; }
        api.setToken(data.token, remember);
        api.user = data.user;
        location.href = 'dashboard.html';
      } catch (x) {
        if (btn) { btn.disabled = false; btn.textContent = btnText; }
        if (err) {
          if (x && x.status === 0) {
            err.textContent = (x.data && x.data.error) || ((typeof window.i18n !== 'undefined' && i18n.t('cannotConnect')) || 'Cannot reach server. Set API URL?');
          } else if (x && x.message && (x.message.includes('fetch') || x.message.includes('Failed'))) {
            err.textContent = (typeof window.i18n !== 'undefined' && i18n.t('cannotConnect')) || 'Cannot reach server. Set API URL?';
          } else {
            err.textContent = (x && x.data && x.data.error) || ((typeof window.i18n !== 'undefined' && i18n.t('signInFailed')) || 'Sign in failed');
          }
          err.style.display = 'block';
        }
      }
    };
  </script>
  <script src="../js/main.js"></script>
</body>
</html>
