# Что забираем из BOLH и лучших практик — сейчас и под миллиард пользователей

**Цель:** Всё, что нам нужно сейчас и в ближайшем будущем. Языки и технологии — лучшие под масштаб и наш стек (security, speed, scalability).

---

## 1. Документация и структура (сейчас)

| Что | Откуда | Технология |
|-----|--------|------------|
| **PROJECT_HISTORY** | BOLH | Один файл: хронология, авторство, ключевые решения. Хранить в репо. |
| **STRUCTURE** | BOLH | Один файл: карта папок и файлов, куда что класть. Обновлять при росте. |
| **DEVELOPMENT** | BOLH | Гайд: порты, команды запуска, env, «что делать дальше», troubleshooting. |

**Язык:** Markdown, в корне или в `docs/`.

---

## 2. Поиск специалистов и гео (сейчас + масштаб)

| Что | Статус | Технология |
|-----|--------|-------------|
| Поиск по профессии + онлайн | ✅ Есть | Go API, SQLite → позже PostgreSQL |
| **Рейтинг/ранжирование** специалистов | Забрать | Go: счётчик рейтинга, сортировка по рейтингу; позже Spark — рекомендации |
| **Расстояние (радиус км)** | Частично (lat/lng есть) | Go: Haversine в запросе или Rust-микросервис geo при росте нагрузки |
| **Обновление локации в реальном времени** | Забрать | WebSocket (Go) или отдельный Rust-сервис для потока координат |

**Языки:** Go (API, WebSocket), при росте — Rust (geo-движок), Spark (рекомендации).

---

## 3. Заказы и уведомления (сейчас + масштаб)

| Что | Статус | Технология |
|-----|--------|-------------|
| Уведомление продавцу, Accept/Decline | ✅ Есть | Go API, notifications_queue |
| **Явная машина состояний заказа** | Забрать | Документ или код: pending → confirmed/cancelled → completed. Валидация переходов в Go. |
| **Обновление статуса в реальном времени** | Забрать | WebSocket: событие `order:status` (Go). Клиент не перезагружает страницу. |
| **Срочные заказы / SOS** | Забрать | Тип заказа или флаг `urgent`; отдельный приоритет в уведомлениях и очереди. |

**Языки:** Go (API, WebSocket, state machine).

---

## 4. Реальное время (WebSocket) — сейчас + масштаб

| Что | Откуда | Технология |
|-----|--------|------------|
| **order:status** | BOLH | Go WebSocket: при смене статуса заказа — push всем подписанным (покупатель, продавец). |
| **Онлайн/локация специалиста** | BOLH | Опционально: поток координат или heartbeat по WebSocket вместо только HTTP. |
| **chat:message** | BOLH | Когда чат из Relay вырастет — доставка сообщений в реальном времени (Go или Rust). |
| **Уведомления в реальном времени** | BOLH | Push новое уведомление по WebSocket, не только polling. |

**Языки:** Go (первая очередь), при очень высокой нагрузке — вынести messaging в Rust.

---

## 5. Безопасность и аудит (сейчас + масштаб)

| Что | Откуда | Технология |
|-----|--------|-------------|
| Rate limiting | ✅ Есть | Go middleware |
| **Audit logging** | BOLH | Логировать: создание/принятие/отмена заказа, смена роли, критические действия. Go + таблица или лог-файл; при масштабе — в отдельный сервис/хранилище. |
| **Шифрование и хранение секретов** | BOLH | Чёткая модель: что шифруется (E2E для чата, ключи кошелька). Крипто — проверенные библиотеки (Go/Rust). |
| **PQC (постквантовая криптография)** | Уже в стеке | Использовать там, где долгоживущие ключи и идентичность. |

**Языки:** Go (audit, API), при необходимости — Rust (крипто-модули).

---

## 6. Кошелёк и бэкап (будущее)

| Что | Откуда | Технология |
|-----|--------|-------------|
| **Экспорт/бэкап ключей или данных кошелька** | BOLH | Зашифрованный экспорт (AES-256, пароль пользователя). Восстановление на другом устройстве. |
| **BIP39 / seed-фраза** | BOLH | Если будет свой кошелёк с ключами у клиента — по стандарту BIP39, проверенные библиотеки (Go/Rust). |

**Языки:** Go или Rust для крипто и форматов; фронт — TypeScript.

---

## 7. Чат (будущее, масштаб)

| Что | Откуда | Технология |
|-----|--------|------------|
| **In-app chat в реальном времени** | BOLH | Relay развить: WebSocket доставка, история в БД, при масштабе — отдельный чат-сервис (Go или Rust). |
| **E2E-шифрование чата** | BOLH | Модель ключей (например, Signal-like), реализация в Go/Rust. |

**Языки:** Go (первая очередь), Rust при высокой нагрузке.

---

## 8. Рекомендации и аналитика (масштаб)

| Что | Откуда | Технология |
|-----|--------|-------------|
| **Рекомендации специалистов** | BOLH (ranking) + наш стек | Spark: рекомендации по профессии, гео, рейтингу, истории заказов. |
| **Аналитика и Big Data** | Наш стек | Spark (Scala/Java): агрегаты, отчёты, пайплайны данных. |

**Языки:** Spark (Scala/Java) — как в ARCHITECTURE.md.

---

## 9. Мобильные приложения (масштаб)

| Что | Откуда | Технология |
|-----|--------|------------|
| **Нативные клиенты** | Наш стек + BOLH опыт | Swift (iOS), Kotlin (Android). Один API (Go), общие контракты. |
| **Офлайн и синхронизация** | BOLH-идея | Кэш заказов/чата, очередь действий, синхр при появлении сети. |

**Языки:** Swift, Kotlin; бэкенд — Go (API).

---

## 10. Инфраструктура и деплой (сейчас + масштаб)

| Что | Откуда | Технология |
|-----|--------|------------|
| **Один скрипт/команда «запустить всё»** | BOLH (pnpm dev:all) | У нас: start-backend.bat; добавить при необходимости: фронт, воркеры, mock. |
| **Миграции БД** | Оба | Уже есть в backend-go; при росте — версионирование, откат. |
| **Масштабирование** | Лучшие практики | Горизонтальное масштабирование API (Go), очереди (заказы, уведомления), кэш (Redis), БД (PostgreSQL). |

**Языки/инструменты:** Go, Bash/Python/YAML (инфра), Docker/K8s при росте.

---

## Итоговый список — что забираем

1. **Документация:** PROJECT_HISTORY, STRUCTURE, DEVELOPMENT (Markdown).
2. **Поиск:** рейтинг/ранжирование, фильтр по радиусу (Haversine), опционально поток локации (WebSocket).
3. **Заказы:** машина состояний (документ + валидация в Go), WebSocket `order:status`, срочные/SOS заказы.
4. **Реальное время:** WebSocket для order:status, уведомлений, чата, опционально онлайн/локация.
5. **Безопасность:** audit logging, модель шифрования (E2E, ключи), PQC где нужно.
6. **Кошелёк:** бэкап/восстановление (AES-256), при необходимости BIP39.
7. **Чат:** развитие Relay в полноценный чат с WebSocket и при масштабе — E2E.
8. **Рекомендации:** Spark для рекомендаций специалистов и аналитики.
9. **Мобильные приложения:** Swift (iOS), Kotlin (Android), один Go API.
10. **Инфраструктура:** одна команда «всё запустить», миграции, готовность к горизонтальному масштабу (Go, Redis, PostgreSQL).

**Языки и технологии (как забираем):**  
Go (API, WebSocket, audit, чат), Rust (geo/тяжёлые движки при росте, крипто при необходимости), Spark (рекомендации, аналитика), Swift/Kotlin (мобильные), TypeScript (веб), PostgreSQL + Redis при масштабе. Всё в соответствии с ARCHITECTURE.md и stack.mdc.
